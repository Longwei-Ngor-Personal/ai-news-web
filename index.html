<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AI-Only News Aggregator</title>
<style>
:root{color-scheme:light dark}
body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;margin:0;display:grid;grid-template-columns:1fr;gap:1rem;padding:1rem 1rem 2rem;max-width:1180px;margin-inline:auto}
h1{font-size:1.5rem;margin:.2rem 0 .6rem}
.controls{display:grid;gap:.6rem}
.row{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
select,button,input,textarea{padding:.45rem .6rem;font-size:.95rem}
textarea{min-height:58px;width:100%}
.status{font-size:.85rem;opacity:.75}
table{width:100%;border-collapse:collapse;margin-top:.6rem}
th,td{padding:.55rem;border-bottom:1px solid #ddd;text-align:left;vertical-align:top}
@media (prefers-color-scheme:dark){th,td{border-color:#333}}
.badge{display:inline-block;padding:.15rem .55rem;border-radius:999px;background:#eee}
@media (prefers-color-scheme:dark){.badge{background:#222}}
.wrapper{display:grid;grid-template-columns:minmax(0,1fr) 320px;gap:1rem}
.card{border:1px solid #e5e5e5;border-radius:10px;padding:.75rem}
@media (prefers-color-scheme:dark){.card{border-color:#333}}
.card h3{margin:.2rem 0 .6rem;font-size:1rem}
.linklist{display:grid;gap:.35rem}
.linklist a{color:inherit;text-decoration:underline}
.feedlog{font-size:.85rem;opacity:.85;line-height:1.35}
.small{font-size:.85rem;opacity:.8}
hr{border:none;border-top:1px dashed #ccc;margin:.8rem 0}
@media (max-width:980px){.wrapper{grid-template-columns:1fr}}
label.inline{display:flex;align-items:center;gap:.35rem}
</style>
</head>
<body>
<h1>ðŸ§  AI-Only News</h1>

<div class="controls card">
  <div class="row">
    <label>Lookback
      <select id="hours">
        <option value="24">24h</option>
        <option value="48" selected>48h</option>
        <option value="72">72h</option>
        <option value="168">7d</option>
      </select>
    </label>
    <label>Show
      <select id="max">
        <option value="10">10</option>
        <option value="20" selected>20</option>
        <option value="30">30</option>
        <option value="50">50</option>
      </select>
    </label>
    <label>Per-source cap
      <select id="perSource">
        <option value="0" selected>no cap</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="5">5</option>
      </select>
    </label>
    <label class="inline"><input type="checkbox" id="strict"> Strict mode</label>
    <button id="fetchBtn">Fetch</button>
    <span id="status" class="status badge">idle</span>
  </div>

  <label>Include keywords (ANY match)
    <textarea id="kwInclude">ai, artificial intelligence, machine learning, ml, deep learning, llm, large language model, generative, genai, gpt, chatgpt, openai, anthropic, claude, gemini, deepmind, llama, mistral, diffusion, transformer, rlhf, fine-tune, embeddings, vector db, retrieval, rag, prompt, safety, guardrails, alignment, multimodal, policy, governance, regulation</textarea>
  </label>

  <label>Exclude keywords (ANY match drops)
    <textarea id="kwExclude">smartphone, iphone, android phone, gaming, console, netflix, disney+, crypto, bitcoin, ethereum, nft, earbuds, headphones, foldable, wearable, social media drama</textarea>
  </label>

  <div class="small">Tip: turn on <b>Strict</b> to require â‰¥2 include keywords; use per-source cap to keep a balanced list.</div>
</div>

<div class="wrapper">
  <div class="card">
    <table id="newsTable">
      <thead>
        <tr><th style="width:44px">#</th><th>Title</th><th style="width:260px">Source</th><th style="width:120px">Date</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <hr>
    <div class="feedlog" id="feedlog"></div>
  </div>

  <aside class="card">
    <h3>Quick Links (open sites directly)</h3>
    <div class="small" style="margin-bottom:.5rem">Section pages without clean public RSS or with paywalls; open in a new tab.</div>

    <h4>Asia (General/Tech)</h4>
    <div class="linklist">
      <a target="_blank" href="https://www.scmp.com/tech">SCMP Tech</a>
      <a target="_blank" href="https://www.cgtn.com/sci-tech.html">CGTN Sci-Tech</a>
      <a target="_blank" href="http://www.xinhuanet.com/english/list/china-science.htm">Xinhua Tech</a>
      <a target="_blank" href="https://www.japantimes.co.jp/business/tech/">Japan Times Tech</a>
      <a target="_blank" href="https://ai.economictimes.com/">Economic Times AI</a>
      <a target="_blank" href="https://www.thehindu.com/sci-tech/technology/">The Hindu Tech</a>
      <a target="_blank" href="https://en.yna.co.kr/">Yonhap (KR)</a>
    </div>

    <h4>SEA â€” by country</h4>
    <div class="small">Brunei</div>
    <div class="linklist">
      <a target="_blank" href="https://borneobulletin.com.bn/">Borneo Bulletin</a>
      <a target="_blank" href="https://www.brudirect.com/">BruDirect</a>
      <a target="_blank" href="https://www.rtbnews.rtb.gov.bn/SitePages/Home.aspx">RTB News</a>
      <a target="_blank" href="https://thescoop.co/">The Scoop</a>
      <a target="_blank" href="https://thebruneian.news/">The Bruneian</a>
    </div>

    <div class="small" style="margin-top:.5rem">Cambodia</div>
    <div class="linklist">
      <a target="_blank" href="https://www.khmertimeskh.com/">Khmer Times</a>
      <a target="_blank" href="https://kiripost.com/topics/technology">Kiripost Tech</a>
      <a target="_blank" href="https://en.freshnewsasia.com/index.php/en/">Fresh News</a>
      <a target="_blank" href="https://www.phnompenhpost.com/national">Phnom Penh Post</a>
      <a target="_blank" href="https://cambodianess.com/">Cambodianess</a>
      <a target="_blank" href="https://b2b-cambodia.com/business/news/">B2B Cambodia</a>
    </div>

    <div class="small" style="margin-top:.5rem">Indonesia</div>
    <div class="linklist">
      <a target="_blank" href="https://www.liputan6.com/news">Liputan6</a>
      <a target="_blank" href="https://en.antaranews.com/">ANTARA</a>
      <a target="_blank" href="https://www.thejakartapost.com/">Jakarta Post</a>
      <a target="_blank" href="https://jakartaglobe.id/">Jakarta Globe</a>
      <a target="_blank" href="https://katadata.co.id/digital">Katadata Digital</a>
      <a target="_blank" href="https://www.techinasia.com/tag/indonesia">Tech in Asia (ID)</a>
      <a target="_blank" href="https://fintechnews.id/">FintechNews ID</a>
    </div>

    <div class="small" style="margin-top:.5rem">Laos</div>
    <div class="linklist">
      <a target="_blank" href="https://laotiantimes.com/">Laotian Times</a>
      <a target="_blank" href="https://www.vientianetimes.org.la/">Vientiane Times</a>
      <a target="_blank" href="https://kpl.gov.la/EN/">KPL (ENG)</a>
    </div>

    <div class="small" style="margin-top:.5rem">Malaysia</div>
    <div class="linklist">
      <a target="_blank" href="https://www.thestar.com.my/">The Star</a>
      <a target="_blank" href="https://www.malaysiakini.com/">Malaysiakini</a>
      <a target="_blank" href="https://www.nst.com.my/">New Straits Times</a>
      <a target="_blank" href="https://www.malaymail.com/">Malay Mail</a>
      <a target="_blank" href="https://www.freemalaysiatoday.com/">FMT</a>
      <a target="_blank" href="https://thesun.my/">The Sun Daily</a>
      <a target="_blank" href="https://theedgemalaysia.com/">The Edge MY</a>
      <a target="_blank" href="https://www.theborneopost.com/">The Borneo Post</a>
      <a target="_blank" href="https://www.bernama.com/en/">BERNAMA</a>
    </div>

    <div class="small" style="margin-top:.5rem">Myanmar</div>
    <div class="linklist">
      <a target="_blank" href="https://www.irrawaddy.com/">The Irrawaddy</a>
      <a target="_blank" href="https://www.frontiermyanmar.net/en/">Frontier Myanmar</a>
      <a target="_blank" href="https://eng.mizzima.com/">Mizzima</a>
      <a target="_blank" href="https://myanmar-now.org/en/">Myanmar Now</a>
    </div>

    <div class="small" style="margin-top:.5rem">Philippines</div>
    <div class="linklist">
      <a target="_blank" href="https://technology.inquirer.net/">Inquirer Tech</a>
      <a target="_blank" href="https://www.philstar.com/">Philippine Star</a>
      <a target="_blank" href="https://mb.com.ph/category/philippines">Manila Bulletin</a>
      <a target="_blank" href="https://www.manilatimes.net/">Manila Times</a>
      <a target="_blank" href="https://manilastandard.net/">Manila Standard</a>
      <a target="_blank" href="https://tribune.net.ph/">Daily Tribune</a>
      <a target="_blank" href="https://www.pna.gov.ph/">PNA</a>
    </div>

    <div class="small" style="margin-top:.5rem">Singapore</div>
    <div class="linklist">
      <a target="_blank" href="https://www.straitstimes.com/global">Straits Times (Global)</a>
      <a target="_blank" href="https://www.channelnewsasia.com/singapore">CNA</a>
      <a target="_blank" href="https://www.todayonline.com/news">Today Online</a>
      <a target="_blank" href="https://mothership.sg/">Mothership</a>
      <a target="_blank" href="https://www.businesstimes.com.sg/global?ref=home-redirect">Business Times</a>
      <a target="_blank" href="https://www.tnp.sg/">The New Paper</a>
    </div>

    <div class="small" style="margin-top:.5rem">Thailand</div>
    <div class="linklist">
      <a target="_blank" href="https://www.bangkokpost.com/thailand">Bangkok Post</a>
      <a target="_blank" href="https://world.thaipbs.or.th/">Thai PBS World</a>
      <a target="_blank" href="https://www.khaosodenglish.com/">Khaosod English</a>
    </div>

    <div class="small" style="margin-top:.5rem">Vietnam</div>
    <div class="linklist">
      <a target="_blank" href="https://vietnamnews.vn/">Viet Nam News</a>
      <a target="_blank" href="https://e.vnexpress.net/">VNExpress Intâ€™l</a>
      <a target="_blank" href="https://news.tuoitre.vn/">Tuoi Tre News</a>
      <a target="_blank" href="https://vietnamnet.vn/en">VietNamNet</a>
      <a target="_blank" href="https://en.vietnamplus.vn/">VietnamPlus</a>
      <a target="_blank" href="https://hanoitimes.vn/">Hanoi Times</a>
    </div>

    <h4 style="margin-top:.8rem">Europe & Global (AI pages)</h4>
    <div class="linklist">
      <a target="_blank" href="https://www.euractiv.com/topics/artificial-intelligence/">Euractiv AI</a>
      <a target="_blank" href="https://www.lemonde.fr/en/artificial-intelligence/">Le Monde AI</a>
      <a target="_blank" href="https://www.theguardian.com/technology/artificialintelligenceai">Guardian AI</a>
      <a target="_blank" href="https://www.telegraph.co.uk/artificial-intelligence/">Telegraph AI</a>
      <a target="_blank" href="https://www.nytimes.com/spotlight/artificial-intelligence">NYT AI</a>
      <a target="_blank" href="https://www.wsj.com/tech/ai">WSJ AI</a>
      <a target="_blank" href="https://www.bbc.com/news/topics/ce1qrvleleqt">BBC AI Topic</a>
      <a target="_blank" href="https://www.economist.com/topics/artificial-intelligence">Economist AI</a>
      <a target="_blank" href="https://www.ft.com/artificial-intelligence">FT AI</a>
      <a target="_blank" href="https://apnews.com/hub/artificial-intelligence">AP AI</a>
      <a target="_blank" href="https://www.washingtonpost.com/technology/innovations/">WaPo Innovations</a>
      <a target="_blank" href="https://edition.cnn.com/">CNN</a>
      <a target="_blank" href="https://www.cnbc.com/">CNBC</a>
      <a target="_blank" href="https://theconversation.com/global">The Conversation</a>
      <a target="_blank" href="https://www.forbes.com/">Forbes</a>
    </div>
  </aside>
</div>

<script>
// ======================
//  RSS FEEDS (aggregated)
// ======================
// Dependable public RSS/Atom endpoints; broad feeds rely on keyword filtering.
const rssFeeds = [
  // AI labs / research / academic
  { name: "OpenAI", url: "https://openai.com/news/rss.xml" },
  { name: "Google AI Blog", url: "https://ai.googleblog.com/feeds/posts/default" },
  { name: "DeepMind Blog", url: "https://deepmind.google/blog/feed/basic.xml" },
  { name: "BAIR Blog", url: "https://bair.berkeley.edu/blog/feed.xml" },
  { name: "arXiv cs.AI", url: "https://export.arxiv.org/rss/cs.AI" },
  { name: "arXiv cs.LG", url: "https://export.arxiv.org/rss/cs.LG" },

  // Tech media (AI sections / general with filtering)
  { name: "TechCrunch AI", url: "https://techcrunch.com/tag/artificial-intelligence/feed/" },
  { name: "The Verge â€“ AI", url: "https://www.theverge.com/artificial-intelligence/rss/index.xml" },
  { name: "Wired AI", url: "https://www.wired.com/feed/tag/artificial-intelligence/latest/rss" },
  { name: "The Guardian â€“ AI", url: "https://www.theguardian.com/technology/artificial-intelligence/rss" },
  { name: "VentureBeat AI", url: "https://venturebeat.com/category/ai/feed/" },
  { name: "MIT Technology Review (all)", url: "https://www.technologyreview.com/feed/" },
  { name: "IEEE Spectrum (all)", url: "https://spectrum.ieee.org/rss" },
  { name: "ScienceDaily AI", url: "https://www.sciencedaily.com/rss/computers_math/artificial_intelligence.xml" },

  // Data science / industry blogs
  { name: "KDnuggets", url: "https://www.kdnuggets.com/feed" },
  { name: "Analytics Vidhya", url: "https://www.analyticsvidhya.com/blog/feed/" },
  { name: "AI Business", url: "https://aibusiness.com/rss" },

  // You can add more feeds here; the app will skip failures automatically.
];

// ======================
//  CORS PROXIES (fallbacks)
// ======================
const proxyFns = [
  (u)=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
  (u)=>`https://cors.isomorphic-git.org/${u}`,
  (u)=>`https://thingproxy.freeboard.io/fetch/${encodeURIComponent(u)}`
];

// ======================
//  UI hooks
// ======================
const statusEl = document.getElementById("status");
const tbody    = document.querySelector("#newsTable tbody");
const hoursSel = document.getElementById("hours");
const maxSel   = document.getElementById("max");
const perSourceSel = document.getElementById("perSource");
const strictEl = document.getElementById("strict");
const feedlog  = document.getElementById("feedlog");
const kwIncEl  = document.getElementById("kwInclude");
const kwExcEl  = document.getElementById("kwExclude");

// ======================
//  Helpers
// ======================
const escapeHtml = (s="") => s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
const dstr = (d) => d ? new Date(d).toISOString().slice(0,10) : "";
const tryParseDate = (text) => {
  const d = text ? new Date(text) : null;
  return isNaN(d?.getTime?.()) ? null : d;
};

function parseXML(xmlText, fallbackSource){
  const xml = new DOMParser().parseFromString(xmlText, "application/xml");
  if (xml.querySelector("parsererror")) throw new Error("XML parse error");
  const items = [];
  const sourceTitle = xml.querySelector("channel > title")?.textContent?.trim()
                    || xml.querySelector("feed > title")?.textContent?.trim()
                    || fallbackSource;

  // Atom
  xml.querySelectorAll("feed > entry").forEach(entry=>{
    const title = entry.querySelector("title")?.textContent?.trim() || "(untitled)";
    const linkEl = entry.querySelector("link[rel='alternate']") || entry.querySelector("link[href]");
    const link = linkEl?.getAttribute("href") || "";
    const dateText = entry.querySelector("updated, published")?.textContent || "";
    const summary = entry.querySelector("summary")?.textContent
                 || entry.querySelector("content")?.textContent
                 || "";
    items.push({ title, url: link, source: sourceTitle, date: tryParseDate(dateText), summary });
  });

  // RSS
  xml.querySelectorAll("channel > item").forEach(item=>{
    const title = item.querySelector("title")?.textContent?.trim() || "(untitled)";
    const link = item.querySelector("link")?.textContent?.trim()
              || item.querySelector("guid")?.textContent?.trim() || "";
    const dateText = item.querySelector("pubDate")?.textContent
                  || item.querySelector("dc\\:date")?.textContent || "";
    const summary = item.querySelector("description")?.textContent
                 || item.querySelector("content\\:encoded")?.textContent
                 || "";
    items.push({ title, url: link, source: sourceTitle, date: tryParseDate(dateText), summary });
  });
  return items;
}

function withTimeout(ms, promise){
  const ctl = new AbortController();
  const t = setTimeout(()=>ctl.abort("timeout"), ms);
  return Promise.race([
    promise(ctl.signal).finally(()=>clearTimeout(t)),
    new Promise((_,rej)=>setTimeout(()=>rej(new Error("timeout")), ms+50))
  ]);
}

async function fetchViaProxies(url, timeoutMs=10000){
  let lastErr;
  for (const make of proxyFns){
    const proxied = make(url);
    try {
      const text = await withTimeout(timeoutMs, (signal)=> fetch(proxied, { signal }).then(r=>{
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.text();
      }));
      return text;
    } catch(e){ lastErr = e; }
  }
  throw lastErr || new Error("All proxies failed");
}

// Concurrency limiter
async function pool(items, limit, worker){
  const ret = [];
  let i = 0, active = 0;
  return new Promise((resolve)=>{
    const next = () => {
      while (active < limit && i < items.length){
        const idx = i++; active++;
        worker(items[idx]).then((val)=> ret[idx]=val).catch((e)=> ret[idx]={error:String(e)}).finally(()=>{
          active--; (i===items.length && active===0) ? resolve(ret) : next();
        });
      }
    };
    next();
  });
}

// Keywords
function parseList(raw){
  return (raw||"").split(",").map(s=>s.trim().toLowerCase()).filter(Boolean);
}
function isAIRelevant(item, includeList, excludeList, strict){
  const hay = `${item.title} ${item.summary||""} ${item.source||""}`.toLowerCase();
  const incMatches = includeList.filter(k=>hay.includes(k)).length;
  if (includeList.length && (strict ? incMatches < 2 : incMatches < 1)) return false;
  if (excludeList.length && excludeList.some(k=>hay.includes(k))) return false;
  return true;
}

// Cache (10 minutes)
function cacheKey(hours,max,per,inc,exc,strict){ return `aiNewsCache:${hours}:${max}:${per}:${inc}:${exc}:${strict?1:0}`; }
function loadCache(k){
  try{ const raw = localStorage.getItem(k); if(!raw) return null;
       const obj = JSON.parse(raw); if (Date.now()-obj.ts>10*60*1000) return null; return obj.items; }catch{ return null; }
}
function saveCache(k,items){ try{ localStorage.setItem(k, JSON.stringify({ts:Date.now(),items})); }catch{} }

// Per-source cap (stable after merge, before final sort)
function applyPerSourceCap(items, cap){
  if (!cap || cap<=0) return items;
  const buckets = new Map();
  for (const it of items){
    const key = it.source || "Unknown";
    const arr = buckets.get(key) || [];
    if (arr.length < cap) { arr.push(it); buckets.set(key, arr); }
  }
  // Flatten preserving rough input order
  const out = [];
  for (const [,arr] of buckets) out.push(...arr);
  return out;
}

// Main
async function fetchNews(){
  const hours  = parseInt(hoursSel.value,10);
  const max    = parseInt(maxSel.value,10);
  const perCap = parseInt(perSourceSel.value,10) || 0;
  const cutoff = Date.now() - hours*3600*1000;

  const incList = parseList(kwIncEl.value);
  const excList = parseList(kwExcEl.value);
  const strict  = !!strictEl.checked;
  const ck = cacheKey(hours,max,perCap,incList.join("|"),excList.join("|"),strict);

  const cached = loadCache(ck);
  if (cached) renderTable(cached, `(cached ${cached.length})`);

  statusEl.textContent = "loadingâ€¦";
  feedlog.innerHTML = "";
  tbody.innerHTML = "";
  const t0 = performance.now();

  const results = await pool(rssFeeds, 5, async (f)=>{
    try{
      const xmlText = await fetchViaProxies(f.url, 10000);
      const parsed = parseXML(xmlText, f.name)
        .filter(it => !it.date || it.date.getTime() >= cutoff)
        .filter(it => isAIRelevant(it, incList, excList, strict));
      return { ok:true, feed:f.name, items:parsed };
    }catch(e){
      return { ok:false, feed:f.name, error:String(e), items:[] };
    }
  });

  // Merge and log
  const all = [];
  results.forEach(r=>{
    if (r.ok){
      all.push(...r.items);
      feedlog.insertAdjacentHTML("beforeend", `<div><b>${escapeHtml(r.feed)}</b>: ok (${r.items.length})</div>`);
    }else{
      feedlog.insertAdjacentHTML("beforeend", `<div><b>${escapeHtml(r.feed)}</b>: fail (${escapeHtml(r.error)})</div>`);
    }
  });

  // Dedupe by (url+title)
  const seen = new Set();
  let uniq = all.filter(it=>{
    const key = (it.url||"")+"|"+(it.title||"");
    if (seen.has(key)) return false; seen.add(key); return true;
  });

  // Optional per-source cap before final sort
  uniq = applyPerSourceCap(uniq, perCap);

  // Sort newest first and cut to max
  uniq.sort((a,b)=>(b.date?.getTime?.()||0)-(a.date?.getTime?.()||0));
  const top = uniq.slice(0, max);

  saveCache(ck, top);
  renderTable(top, `ok (${top.length}) â€¢ ${(performance.now()-t0|0)}ms`);
}

function renderTable(items, statusText="ok"){
  statusEl.textContent = statusText;
  tbody.innerHTML = "";
  if (!items.length){
    tbody.innerHTML = `<tr><td colspan="4">No AI-relevant items for this window/keywords. Try widening lookback or adjusting filters, or click again shortly (proxies can throttle).</td></tr>`;
    return;
  }
  items.forEach((it,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td><a href="${it.url}" target="_blank" rel="noopener">${escapeHtml(it.title)}</a></td>
      <td>${escapeHtml(it.source||"")}</td>
      <td>${dstr(it.date)}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById("fetchBtn").addEventListener("click", fetchNews);
fetchNews();
</script>
</body>
</html>
